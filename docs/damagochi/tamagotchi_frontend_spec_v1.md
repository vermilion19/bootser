# 온라인 다마고치 서비스 - 프론트엔드 기획서(초안)

- 버전: **v1.0**
- 기준일: **2026-02-13**
- 범위: **웹(브라우저) 기반, React + Canvas 혼합, 턴제 배틀**

## 1. 목표와 MVP 범위
- 로그인 후 즐기는 회원 기반 온라인 다마고치형 육성 서비스의 **프론트엔드 UX/구현 기준**을 정의한다.
- MVP 목표: **메인(생활) 화면의 돌봄 루프 + 크리처 슬롯/Active 관리 + 턴제 배틀(기본 연출)**을 안정적으로 제공한다.

**MVP 포함**
- 로그인/회원가입
- 게임 메인(생활) 화면: 상태 표시, 행동(식사/치료/취침), 알림
- 크리처 생성(분양)
- 크리처 관리: 계정당 최대 3마리, Active 1마리/Backup 전환
- 배틀: 랜덤/방 배틀 진입, 턴제 진행, 결과 화면
- 타격감 연출: 플래시/쉐이크/데미지 숫자/간단 파티클

**MVP 제외(추후)**
- 채팅
- 복잡한 상점/재화/퀘스트
- 시즌 랭킹/리그(기본 전적 표시는 가능)

## 2. 핵심 사용자 플로우
1) (비로그인) 로그인/회원가입
2) 로그인 성공 -> 게임 메인(`/app`)
3) 크리처 없음 -> 분양(`/app/creatures/new`)
4) 메인에서 돌봄 행동(식사/치료/취침) -> 상태 변화 피드백
5) 배틀 진입(`/app/battle`) -> 랜덤 매칭 또는 방 생성/참가
6) 턴 선택 -> 서버 턴 결과 이벤트 수신 -> Canvas 연출 재생
7) 결과 확인 -> 메인 복귀

## 3. 정보구조(IA) / 라우팅
| 구분 | 경로 | 설명 |
|---|---|---|
| 인증 | `/login` | 로그인 |
| 인증 | `/signup` | 회원가입 |
| 앱 | `/app` | 메인(생활) 화면 |
| 앱 | `/app/creatures` | 크리처 슬롯/Active/Backup 관리 |
| 앱 | `/app/creatures/new` | 크리처 생성(분양) |
| 앱 | `/app/battle` | 배틀 진입(랜덤/방) |
| 앱 | `/app/battle/room` | 방 생성/참가 |
| 앱 | `/app/battle/:battleId` | 배틀 진행 |
| 앱 | `/app/settings`(선택) | 사운드/연출 on/off 등 설정 |

### 3.1 보호 라우트(필수)
- `/app/*`는 **로그인 필수**. 토큰 없음/만료 시 `/login`으로 리다이렉트.
- 세션 만료 UX: 토스트("세션이 만료되었습니다") 후 로그인 화면으로 이동. 진행 중 배틀은 중단 처리.
## 4. 화면별 기획
### 4.1 로그인/회원가입
- 필드: 이메일, 비밀번호(가입 시 확인 비밀번호)
- UX: 로딩 상태, 에러 메시지(유효성/서버), 비밀번호 표시 토글(선택)
- 로그인 성공 시 사용자/크리처 요약을 프리패치 후 `/app` 이동
### 4.2 메인(생활) 화면 `/app`
**레이아웃(권장)**
- 상단 HUD: 건강/배고픔/컨디션(항상 노출)
- 중앙: `CreatureCanvas`(Idle/Sleep/Action)
- 하단: 행동 버튼 패널(식사/치료/잠들기/배틀/관리)
- 보조 정보: 나이/승률(전적), 질병/부상 아이콘(툴팁/상세)
- 낮/밤 인디케이터(밤: 취침 권장)

**행동 버튼 공통 규칙**
- 불가 상태는 비활성 + 사유 툴팁(예: "자는 중", "치료 아이템 없음")
- 행동 실행 시: 버튼 로딩 -> 성공 토스트(변화량) + Canvas 이펙트(하트/반짝)
- 취침: 취침 시작/해제 토글. 취침 중에는 상태(나이 제외) 고정 표시

**상태 업데이트**
- MVP: 폴링(예: 10~30초) + 행동 직후 즉시 리패치
- 배틀은 WebSocket 또는 전용 폴링(매칭/진행)에 따라 선택

### 4.3 크리처 생성(분양) `/app/creatures/new`
- 생성 가능 조건: 슬롯 여유(최대 3)
- 입력: 이름(선택), 초기 타입(선택, 추후)
- 결과: 생성 완료 -> `/app/creatures` 또는 `/app`로 이동(Active 지정 필요 시 안내)
### 4.4 크리처 관리(슬롯/Active/Backup) `/app/creatures` (필수)
- 카드 목록: 3슬롯(비어있음/사용중)
- 각 카드: 종/단계, 주요 상태(요약), 질병/부상 여부, Active/Backup 표시
- Active 전환: 쿨다운/일일 제한 등 서버 정책을 그대로 반영해 UI에 표시
- Backup: 정책에 따라 상태 동결 여부를 명확히 표기
### 4.5 배틀 진입 `/app/battle` 및 방 `/app/battle/room`
- 랜덤 배틀: 큐 참가 -> 대기 -> 매칭 완료 -> `/app/battle/:battleId`
- 방 배틀: 방 생성(코드 발급) / 코드 입력 참가
- 승률 반영 정책이 다르면 UI에 구분 표기(예: 랜덤만 승률 반영)

### 4.6 배틀 진행 `/app/battle/:battleId` (턴제)
**화면 구성**
- 상단: 내/상대 크리처 HUD(HP/상태이상/이름)
- 중앙: BattleCanvas(전투 연출)
- 하단: 턴 선택 UI(공격/방어/스킬/아이템 - MVP는 공격/방어만으로 시작 가능)

**턴 처리 모델(권장)**
- 프론트는 '행동 선택'만 전송
- 서버는 턴 결과를 '이벤트 리스트'로 반환(아래 8장 참고)
- 프론트는 이벤트를 순차 재생하는 **연출 플레이어**로 구현

### 4.7 배틀 결과
- 승/패/무 표시
- 변화한 전적/승률 요약
- 메인 복귀 버튼
- (선택) 리플레이: 서버 이벤트 로그 재생(추후)
## 5. 공통 UI 규격
- 토스트/스낵바: 성공/오류/정보 표준화
- 모달: 위험 행동(Active 전환, 추후 합체) 확인
- 로딩: 스켈레톤(메인 HUD/크리처 영역), 스피너(버튼)
- 에러: 네트워크 오류, 401/403, 500 공통 핸들링
- 반응형: 모바일 우선(세로), 데스크탑은 중앙 정렬 카드형
## 6. React + Canvas 혼합 아키텍처(권장)
### 6.1 책임 분리
- React(DOM): 라우팅, 폼, 버튼/모달, HUD/리스트, 접근성
- Canvas: 크리처 렌더링, 배틀 연출, 파티클/플래시/쉐이크

**원칙**: 메인 페이지 전체를 Canvas로 만들지 말고, **크리처/배틀 영역만 Canvas**로 제한한다.
### 6.2 Canvas 렌더 규칙(도트 유지)
- `ctx.imageSmoothingEnabled = false`
- CSS: `image-rendering: pixelated`
- 스프라이트 단위는 32x32(또는 48x48)로 고정하고, scale로 확대

### 6.3 애니메이션 상태 머신(예시)
- `idle`, `blink`, `sleep`, `eat`, `hurt`, `attack`, `win`, `lose`
- React state가 바뀌면 Canvas는 해당 상태의 시트/프레임을 재생

## 7. 타격감(이펙트) 가이드(MVP)
- Hit Flash: 피격 대상 2~3프레임 밝게/흰색 틴트
- Screen Shake: 100~180ms, 6~10px 범위
- Damage Number: 위로 떠오르며 페이드아웃
- Particle: 별/번쩍 2~3프레임(공용)

> 프레임을 많이 늘리기보다, 코드 이펙트로 타격감을 확보한다.
## 8. 서버 이벤트(턴 결과) 계약 초안
턴 결과는 아래처럼 이벤트 배열로 반환(또는 WS로 푸시)하는 것을 권장한다.

```json
{
  "battleId": "b_123",
  "turn": 5,
  "events": [
    {"type":"ATTACK", "from":"P1", "to":"P2", "skill":"BASIC"},
    {"type":"DAMAGE", "to":"P2", "amount": 12, "hpAfter": 58, "critical": false},
    {"type":"HIT_EFFECT", "to":"P2", "flash": true, "shake": true},
    {"type":"TURN_END"}
  ]
}
```

프론트는 `events`를 순서대로 재생하여 연출을 구성한다(타임라인 플레이어).
## 9. 프론트 상태관리/데이터 패칭
- 인증: JWT(Access/Refresh) 기반 가정. 401 수신 시 재발급 또는 로그인 이동
- 보호 라우트: `/app/*` 진입 전 사용자/세션 검증
- Server State: 캐시/리패치를 표준화(TanStack Query 등)
- 메인 상태: 폴링 + 행동 직후 즉시 갱신
- 배틀: 매칭/진행은 WS 또는 짧은 폴링(1~2초)로 시작 가능

## 10. 애셋(스프라이트) 규격
- 기본 크기: 32x32 PNG(투명)
- 시트: 가로 배열(프레임 N개)
- 메타 JSON: 프레임 크기, 프레임 순서, duration(ms)

예시:
```json
{
  "frameSize": {"w": 32, "h": 32},
  "idle": {"sheet": "idle_sheet.png", "frames": [0,1,2,3], "durationMs": 140},
  "sleep": {"sheet": "sleep_sheet.png", "frames": [0,1], "durationMs": 350}
}
```
## 11. 체크리스트(출시 전)
- 로그인/세션 만료/재로그인 플로우 정상 동작
- 크리처 없음/슬롯 가득 참/Active 전환 제한 등 엣지 케이스 처리
- 배틀 중 새로고침/탭 이동/네트워크 끊김 복구 UX
- 도트 렌더링 깨짐 없음(블러/스무딩 OFF)
- 에러 로깅/추적(최소한 콘솔/네트워크 오류 수집)
